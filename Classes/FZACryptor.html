<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="html/html; charset=utf-8" />
		<title>FZACryptor Class Reference</title>
		<meta id="xcode-display" name="xcode-display" content="render"/>
		<link rel="stylesheet" type="text/css" href="../css/styles.css" media="all" />
		<link rel="stylesheet" type="text/css" media="print" href="../css/stylesPrint.css" />
		<meta name="generator" content="appledoc 2.1 (build 858)" />
	</head>
	<body>
		<header id="top_header">
			<div id="library" class="hideInXcode">
				<h1><a id="libraryTitle" href="../index.html">TICoreDataSync </a></h1>
				<a id="developerHome" href="../index.html">Tim Isted</a>
			</div>
			
			<div id="title" role="banner">
				<h1 class="hideInXcode">FZACryptor Class Reference</h1>
			</div>
			<ul id="headerButtons" role="toolbar">
				<li id="toc_button">
					<button aria-label="Show Table of Contents" role="checkbox" class="open" id="table_of_contents"><span class="disclosure"></span>Table of Contents</button>
				</li>
				<li id="jumpto_button" role="navigation">
					<select id="jumpTo">
	<option value="top">Jump To&#133;</option>
	
	<option value="overview">Overview</option>
	
	
	
	
	<option value="tasks">Tasks</option>
	
	
	
	
	
	
	
	
	
	<option value="instance_methods">Instance Methods</option>
	
	<option value="//api/name/clearPasswordAndSalt">&nbsp;&nbsp;&nbsp;&nbsp;- clearPasswordAndSalt</option>
	
	<option value="//api/name/decryptFileAtLocation:writingToLocation:error:">&nbsp;&nbsp;&nbsp;&nbsp;- decryptFileAtLocation:writingToLocation:error:</option>
	
	<option value="//api/name/encryptFileAtLocation:writingToLocation:error:">&nbsp;&nbsp;&nbsp;&nbsp;- encryptFileAtLocation:writingToLocation:error:</option>
	
	<option value="//api/name/isConfigured">&nbsp;&nbsp;&nbsp;&nbsp;- isConfigured</option>
	
	<option value="//api/name/setPassword:salt:error:">&nbsp;&nbsp;&nbsp;&nbsp;- setPassword:salt:error:</option>
	
	
	
</select>
				</li>
			</ul>
		</header>
		<nav id="tocContainer" class="isShowingTOC">
			<ul id="toc" role="tree">
				
<li role="treeitem"><span class="nodisclosure"></span><span class="sectionName"><a href="#overview">Overview</a></span></li>




<li role="treeitem" id="task_treeitem"><span class="nodisclosure"></span><span class="sectionName"><a href="#tasks">Tasks</a></span><ul>
	
	<li><span class="nodisclosure"></span><span class="sectionName"><a href="#task_Configuration">Configuration</a></span></li>
	
	<li><span class="nodisclosure"></span><span class="sectionName"><a href="#task_Encryption and Decryption">Encryption and Decryption</a></span></li>
	
</ul></li>









<li role="treeitem" class="children"><span class="disclosure"></span><span class="sectionName"><a href="#instance_methods">Instance Methods</a></span><ul>
	
	<li><span class="nodisclosure"></span><span class="sectionName"><a href="#//api/name/clearPasswordAndSalt">clearPasswordAndSalt</a></span></li>
	
	<li><span class="nodisclosure"></span><span class="sectionName"><a href="#//api/name/decryptFileAtLocation:writingToLocation:error:">decryptFileAtLocation:writingToLocation:error:</a></span></li>
	
	<li><span class="nodisclosure"></span><span class="sectionName"><a href="#//api/name/encryptFileAtLocation:writingToLocation:error:">encryptFileAtLocation:writingToLocation:error:</a></span></li>
	
	<li><span class="nodisclosure"></span><span class="sectionName"><a href="#//api/name/isConfigured">isConfigured</a></span></li>
	
	<li><span class="nodisclosure"></span><span class="sectionName"><a href="#//api/name/setPassword:salt:error:">setPassword:salt:error:</a></span></li>
	
</ul></li>


			</ul>
		</nav>
		<article>
			<div id="contents" class="isShowingTOC" role="main">
				<a title="FZACryptor Class Reference" name="top"></a>
				<div class="main-navigation navigation-top">
					<ul>
	<li><a href="../index.html">Index</a></li>
	<li><a href="../hierarchy.html">Hierarchy</a></li>
</ul>
				</div>
				<div id="header">
					<div class="section-header">
						<h1 class="title title-header">FZACryptor Class Reference</h1>
					</div>		
				</div>
				<div id="container">	
					
					<div class="section section-specification"><table cellspacing="0"><tbody>
						<tr>
	<td class="specification-title">Inherits from</td>
	<td class="specification-value">NSObject</td>
</tr><tr>
	<td class="specification-title">Declared in</td>
	<td class="specification-value">FZACryptor.h</td>
</tr>
						</tbody></table></div>
					
					
					
					
					<div class="section section-overview">
						<a title="Overview" name="overview"></a>
						<h2 class="subtitle subtitle-overview">Overview</h2>
						<p><code>FZACryptor</code> is the public interface to the <code>TICoreDataSync</code> encryption module.</p>
					</div>
					
					
					
					
					
					<div class="section section-tasks">
						<a title="Tasks" name="tasks"></a>
						<h2 class="subtitle subtitle-tasks">Tasks</h2>
						
						
						<a title="Configuration" name="task_Configuration"></a>
						<h3 class="subsubtitle task-title">Configuration</h3>

						<ul class="task-list">
							<li>
	<span class="tooltip">
		<code><a href="#//api/name/isConfigured">&ndash;&nbsp;isConfigured</a></code>
		<span class="tooltip"><p>Reports whether this object has already got a key and can be used for crypto operations.</p></span>
	</span>
	
	
</li><li>
	<span class="tooltip">
		<code><a href="#//api/name/setPassword:salt:error:">&ndash;&nbsp;setPassword:salt:error:</a></code>
		<span class="tooltip"><p>Set a new password to be used for protecting the encrypted content.</p></span>
	</span>
	
	
</li><li>
	<span class="tooltip">
		<code><a href="#//api/name/clearPasswordAndSalt">&ndash;&nbsp;clearPasswordAndSalt</a></code>
		<span class="tooltip"><p>Clears any previously-existing keychain password and salt.</p></span>
	</span>
	
	
</li>
						</ul>
						
						
						<a title="Encryption and Decryption" name="task_Encryption and Decryption"></a>
						<h3 class="subsubtitle task-title">Encryption and Decryption</h3>

						<ul class="task-list">
							<li>
	<span class="tooltip">
		<code><a href="#//api/name/encryptFileAtLocation:writingToLocation:error:">&ndash;&nbsp;encryptFileAtLocation:writingToLocation:error:</a></code>
		<span class="tooltip"><p>Encrypt the content of a file, storing the encrypted data in another file.</p></span>
	</span>
	
	
</li><li>
	<span class="tooltip">
		<code><a href="#//api/name/decryptFileAtLocation:writingToLocation:error:">&ndash;&nbsp;decryptFileAtLocation:writingToLocation:error:</a></code>
		<span class="tooltip"><p>Decrypt the content of a file, storing the clear-text data in another file.</p></span>
	</span>
	
	
</li>
						</ul>
						
					</div>
					
					
					
					
					
					
					
					
					
					<div class="section section-methods">
						<a title="Instance Methods" name="instance_methods"></a>
						<h2 class="subtitle subtitle-methods">Instance Methods</h2>
						
						<div class="section-method">
	<a name="//api/name/clearPasswordAndSalt" title="clearPasswordAndSalt"></a>
	<h3 class="subsubtitle method-title">clearPasswordAndSalt</h3>
	
	
	
	<div class="method-subsection brief-description">
		<p>Clears any previously-existing keychain password and salt.</p>
	</div>		
	
    

	<div class="method-subsection method-declaration"><code>- (void)clearPasswordAndSalt</code></div>

    
	
	
	
	
	
	
	
	
	
	
	
	
	
	<div class="method-subsection declared-in-section">
		<h4 class="method-subtitle">Declared In</h4>
		<code class="declared-in-ref">FZACryptor.h</code><br />
	</div>				
	
	
</div>
						
						<div class="section-method">
	<a name="//api/name/decryptFileAtLocation:writingToLocation:error:" title="decryptFileAtLocation:writingToLocation:error:"></a>
	<h3 class="subsubtitle method-title">decryptFileAtLocation:writingToLocation:error:</h3>
	
	
	
	<div class="method-subsection brief-description">
		<p>Decrypt the content of a file, storing the clear-text data in another file.</p>
	</div>		
	
    

	<div class="method-subsection method-declaration"><code>- (BOOL)decryptFileAtLocation:(NSURL *)<em>cipherTextURL</em> writingToLocation:(NSURL *)<em>plainTextURL</em> error:(NSError **)<em>error</em></code></div>

    
	
	<div class="method-subsection arguments-section parameters">
		<h4 class="method-subtitle parameter-title">Parameters</h4>
		
		<dl class="argument-def parameter-def">
			<dt><em>cipherTextURL</em></dt>
			<dd><p>The file to be decrypted.</p></dd>
		</dl>
		
		<dl class="argument-def parameter-def">
			<dt><em>plainTextURL</em></dt>
			<dd><p>The location to write the decrypted file. Any existing content will be blindly truncated.</p></dd>
		</dl>
		
		<dl class="argument-def parameter-def">
			<dt><em>error</em></dt>
			<dd><p>Possible errors include no password being configured or the keychain item being corrupted, not being able to read from the source or write to the destination, or the cipher text file not being in the expected format. Errors come either from <code>CommonCrypto/CommonCryptor.h</code> or from the enumeration at the end of <code>TICDSTypesAndEnums.h</code>.</p></dd>
		</dl>
		
	</div>
	
	
	
	<div class="method-subsection return">
		<h4 class="method-subtitle parameter-title">Return Value</h4>
		<p><code>YES</code> if the decryption succeeds, otherwise <code>NO</code> and the error is set.</p>
	</div>
	
	
	
	
	
	<div class="method-subsection discussion-section">
		<h4 class="method-subtitle">Discussion</h4>
		<blockquote><p>%warning%<br/>
<strong>Warning:</strong> Any exceptions encountered in dealing with the filesystem will be propagated to the calling code. It is therefore up to the calling code to make sure it&rsquo;s working with a reliable filesystem, or to handle exceptions occurring in here.</p></blockquote>
	</div>
	
	
	
	
	
	
	
	<div class="method-subsection declared-in-section">
		<h4 class="method-subtitle">Declared In</h4>
		<code class="declared-in-ref">FZACryptor.h</code><br />
	</div>				
	
	
</div>
						
						<div class="section-method">
	<a name="//api/name/encryptFileAtLocation:writingToLocation:error:" title="encryptFileAtLocation:writingToLocation:error:"></a>
	<h3 class="subsubtitle method-title">encryptFileAtLocation:writingToLocation:error:</h3>
	
	
	
	<div class="method-subsection brief-description">
		<p>Encrypt the content of a file, storing the encrypted data in another file.</p>
	</div>		
	
    

	<div class="method-subsection method-declaration"><code>- (BOOL)encryptFileAtLocation:(NSURL *)<em>plainTextURL</em> writingToLocation:(NSURL *)<em>cipherTextURL</em> error:(NSError **)<em>error</em></code></div>

    
	
	<div class="method-subsection arguments-section parameters">
		<h4 class="method-subtitle parameter-title">Parameters</h4>
		
		<dl class="argument-def parameter-def">
			<dt><em>plainTextURL</em></dt>
			<dd><p>The URL of the file to be encrypted.</p></dd>
		</dl>
		
		<dl class="argument-def parameter-def">
			<dt><em>cipherTextURL</em></dt>
			<dd><p>The URL of the file to write the encrypted file. Any existing content will be blindly truncated.</p></dd>
		</dl>
		
		<dl class="argument-def parameter-def">
			<dt><em>error</em></dt>
			<dd><p>Possible errors include no password being configured or the keychain item being corrupted, or not being able to read from the source or  write to the destination. The error codes come from <code>CommonCrypto/CommonCryptor.h</code>.</p></dd>
		</dl>
		
	</div>
	
	
	
	<div class="method-subsection return">
		<h4 class="method-subtitle parameter-title">Return Value</h4>
		<p><code>YES</code> if the encryption succeeds, otherwise <code>NO</code> and the error is set.</p>
	</div>
	
	
	
	
	
	<div class="method-subsection discussion-section">
		<h4 class="method-subtitle">Discussion</h4>
		<p>The file format is like this, where the numbers are byte indices:<br/>
     0-15           An IV used to protect the first block of file key and IV.<br/>
     16-63          The file key and IV, which have been encrypted by the sync key.<br/>
     64-(end-32)    The file content, encrypted by the file key.<br/>
     (end-32)-end   A SHA-256 HMAC derived using the sync key.</p><blockquote><p>%warning%<br/>
<strong>Warning:</strong> Any exceptions encountered in dealing with the filesystem will be propagated to the calling code. It is therefore up to the calling code to make sure it&rsquo;s working with a reliable filesystem, or to handle exceptions occurring in here.</p></blockquote>
	</div>
	
	
	
	
	
	
	
	<div class="method-subsection declared-in-section">
		<h4 class="method-subtitle">Declared In</h4>
		<code class="declared-in-ref">FZACryptor.h</code><br />
	</div>				
	
	
</div>
						
						<div class="section-method">
	<a name="//api/name/isConfigured" title="isConfigured"></a>
	<h3 class="subsubtitle method-title">isConfigured</h3>
	
	
	
	<div class="method-subsection brief-description">
		<p>Reports whether this object has already got a key and can be used for crypto operations.</p>
	</div>		
	
    

	<div class="method-subsection method-declaration"><code>- (BOOL)isConfigured</code></div>

    
	
	
	
	<div class="method-subsection return">
		<h4 class="method-subtitle parameter-title">Return Value</h4>
		<p><code>YES</code> if the object is ready to be used for crypto, otherwise <code>NO</code>.</p>
	</div>
	
	
	
	
	
	<div class="method-subsection discussion-section">
		<h4 class="method-subtitle">Discussion</h4>
		<p>If this method returns <code>NO</code>, the app should get a password from the user and call <code>setPassword:salt:</code>.</p>
	</div>
	
	
	
	
	
	
	
	<div class="method-subsection declared-in-section">
		<h4 class="method-subtitle">Declared In</h4>
		<code class="declared-in-ref">FZACryptor.h</code><br />
	</div>				
	
	
</div>
						
						<div class="section-method">
	<a name="//api/name/setPassword:salt:error:" title="setPassword:salt:error:"></a>
	<h3 class="subsubtitle method-title">setPassword:salt:error:</h3>
	
	
	
	<div class="method-subsection brief-description">
		<p>Set a new password to be used for protecting the encrypted content.</p>
	</div>		
	
    

	<div class="method-subsection method-declaration"><code>- (NSData *)setPassword:(NSString *)<em>password</em> salt:(NSData *)<em>salt</em> error:(NSError **)<em>outError</em></code></div>

    
	
	<div class="method-subsection arguments-section parameters">
		<h4 class="method-subtitle parameter-title">Parameters</h4>
		
		<dl class="argument-def parameter-def">
			<dt><em>password</em></dt>
			<dd><p>The password to use.</p></dd>
		</dl>
		
		<dl class="argument-def parameter-def">
			<dt><em>salt</em></dt>
			<dd><p>Some random data to salt the password. If this is <code>nil</code>, the method will<br/>
             generate its own salt from a random oracle.</p></dd>
		</dl>
		
		<dl class="argument-def parameter-def">
			<dt><em>outError</em></dt>
			<dd><p>A pointer to an <code>NSError</code> that will be set if the data cannot be generated.</p></dd>
		</dl>
		
	</div>
	
	
	
	<div class="method-subsection return">
		<h4 class="method-subtitle parameter-title">Return Value</h4>
		<p>The data used for salting the password. If this object needed to create salt material and couldn&rsquo;t, it will return <code>nil</code>. In this case, the key used for encryption has not been set, and the object is not configured.</p>
	</div>
	
	
	
	
	
	<div class="method-subsection discussion-section">
		<h4 class="method-subtitle">Discussion</h4>
		<p>This can either be used to initially configure the cryptography, or unilaterally change the password (without doing any re-encryption of existing data) at a later time.</p><blockquote><p>%warning%<br/>
<strong>Warning:</strong> This class uses the keychain for secure storage, so it&rsquo;s possible for a newly-created instance not to need a password if the key material has already been created. Check <a href="#//api/name/isConfigured"><code>isConfigured</code></a> to see whether this is the case.</p></blockquote>
	</div>
	
	
	
	
	
	
	
	<div class="method-subsection declared-in-section">
		<h4 class="method-subtitle">Declared In</h4>
		<code class="declared-in-ref">FZACryptor.h</code><br />
	</div>				
	
	
</div>
						
					</div>
					
					
				</div>
				<div class="main-navigation navigation-bottom">
					<ul>
	<li><a href="../index.html">Index</a></li>
	<li><a href="../hierarchy.html">Hierarchy</a></li>
</ul>
				</div>
				<div id="footer">
					<hr />
					<div class="footer-copyright">
						<p><span class="copyright">&copy; 2013 Tim Isted. All rights reserved. (Last updated: 2013-05-10)</span><br />
						
						<span class="generator">Generated by <a href="http://appledoc.gentlebytes.com">appledoc 2.1 (build 858)</a>.</span></p>
						
					</div>
				</div>
			</div>
		</article>
		<script type="text/javascript">
			function jumpToChange()
			{
				window.location.hash = this.options[this.selectedIndex].value;
			}
			
			function toggleTOC()
			{
				var contents = document.getElementById('contents');
				var tocContainer = document.getElementById('tocContainer');
				
				if (this.getAttribute('class') == 'open')
				{
					this.setAttribute('class', '');
					contents.setAttribute('class', '');
					tocContainer.setAttribute('class', '');
					
					window.name = "hideTOC";
				}
				else
				{
					this.setAttribute('class', 'open');
					contents.setAttribute('class', 'isShowingTOC');
					tocContainer.setAttribute('class', 'isShowingTOC');
					
					window.name = "";
				}
				return false;
			}
			
			function toggleTOCEntryChildren(e)
			{
				e.stopPropagation();
				var currentClass = this.getAttribute('class');
				if (currentClass == 'children') {
					this.setAttribute('class', 'children open');
				}
				else if (currentClass == 'children open') {
					this.setAttribute('class', 'children');
				}
				return false;
			}
			
			function tocEntryClick(e)
			{
				e.stopPropagation();
				return true;
			}
			
			function init()
			{
				var selectElement = document.getElementById('jumpTo');
				selectElement.addEventListener('change', jumpToChange, false);
				
				var tocButton = document.getElementById('table_of_contents');
				tocButton.addEventListener('click', toggleTOC, false);
				
				var taskTreeItem = document.getElementById('task_treeitem');
				if (taskTreeItem.getElementsByTagName('li').length > 0)
				{
					taskTreeItem.setAttribute('class', 'children');
					taskTreeItem.firstChild.setAttribute('class', 'disclosure');
				}
				
				var tocList = document.getElementById('toc');
				
				var tocEntries = tocList.getElementsByTagName('li');
				for (var i = 0; i < tocEntries.length; i++) {
					tocEntries[i].addEventListener('click', toggleTOCEntryChildren, false);
				}
				
				var tocLinks = tocList.getElementsByTagName('a');
				for (var i = 0; i < tocLinks.length; i++) {
					tocLinks[i].addEventListener('click', tocEntryClick, false);
				}
				
				if (window.name == "hideTOC") {
					toggleTOC.call(tocButton);
				}
			}
			
			window.onload = init;
			
			// If showing in Xcode, hide the TOC and Header
			if (navigator.userAgent.match(/xcode/i)) {
				document.getElementById("contents").className = "hideInXcode"
				document.getElementById("tocContainer").className = "hideInXcode"
				document.getElementById("top_header").className = "hideInXcode"
			}
			
		</script>
	</body>
</html>